<div class="page-content">
    <div class="panel panel-boxed">
        <div class="panel-body">
            <div class="row">
                <div class="col-md-6">
                    <h3><%= language.name %></h3>
                </div>
                <div class="col-md-6 text-right">
                    <button type="button" class="btn btn-info btn-translate" data-language-id="<%= language._id %>" data-language-code="<%= language.code %>">
                        <i class="fa fa-language"></i> Auto Translate from English
                    </button>
                </div>
            </div>
            <h3 class="mt-50">Or Upload Words Manually</h3>
            <form method="post" action="/admin/saveLanguageWord/<%=language.id%>">
                <div class="row">
                    <% words.map(item=>{%>
                    <div class="col-12 col-lg-6">
                        <div class="form-group">
                            <label><%=item.name%></label>
                            <input type="text" name="language_word-<%=item.id%>"
                                   class="form-control"
                                   value="<%= typeof language_words_map[item.id]!="undefined" ? language_words_map[item.id].value : '' %>"
                            >
                        </div>
                    </div>
                    <% })%>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    $('.btn-translate').click(function() {
        const languageId = $(this).data('language-id');
        const languageCode = $(this).data('language-code');
        const btn = $(this);
        
        // Don't translate if it's English
        if (languageCode === 'en') {
            alert('Cannot translate English to English!');
            return;
        }
        
        if (confirm('This will translate all English words to ' + languageCode + '. Existing translations will be overwritten. Continue?')) {
            btn.prop('disabled', true).html('<i class="fa fa-spinner fa-spin"></i> Translating...');
            
            $.ajax({
                url: '/admin/translate-language-words',
                method: 'POST',
                data: {
                    language_id: languageId,
                    target_language_code: languageCode
                },
                success: function(response) {
                    if (response.status === 'success') {
                        alert(response.msg);
                        // Reload the page to show new translations
                        window.location.reload();
                    } else {
                        alert('Translation failed: ' + response.msg);
                    }
                },
                error: function() {
                    alert('Translation failed: Server error');
                },
                complete: function() {
                    btn.prop('disabled', false).html('<i class="fa fa-language"></i> Auto Translate from English');
                }
            });
        }
    });
});
</script>
