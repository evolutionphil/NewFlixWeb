<div class="page-content">
    <div class="panel panel-boxed">
        <div class="panel-body">
            <h3 class="text-right"><%= language.name %></h3>
            <div class="row mb-4">
                <div class="col-md-6">
                    <h3 class="mt-50">Or Upload Words Manually</h3>
                </div>
                <div class="col-md-6 text-right">
                    <button type="button" class="btn btn-info" id="autoTranslateBtn" onclick="autoTranslate()">
                        <i class="fa fa-copy"></i> Fill Empty Fields with English Text
                    </button>
                </div>
            </div>
            <form method="post" action="/admin/saveLanguageWord/<%=language.id%>">
                <div class="row">
                    <% words.map(item=>{%>
                    <div class="col-12 col-lg-6">
                        <div class="form-group">
                            <label><%=item.name%></label>
                            <input type="text" name="language_word-<%=item.id%>"
                                   class="form-control"
                                   value="<%= typeof language_words_map[item.id]!="undefined" ? language_words_map[item.id].value : '' %>"
                            >
                        </div>
                    </div>
                    <% })%>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function autoTranslate() {
    const btn = document.getElementById('autoTranslateBtn');
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Filling Fields...';
    btn.disabled = true;

    // Get all English words that need translation
    const wordsToTranslate = [];
    <% words.forEach(function(word) { %>
        wordsToTranslate.push({
            id: '<%= word.id %>',
            name: '<%= word.name %>',
            currentValue: document.querySelector('input[name="language_word-<%= word.id %>"]').value
        });
    <% }); %>

    // Call the translation API
    fetch('/admin/translateWords', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            words: wordsToTranslate,
            targetLanguageCode: '<%= language.code %>',
            languageId: '<%= language.id %>'
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            // Update the form fields with translated text
            data.translations.forEach(translation => {
                const input = document.querySelector(`input[name="language_word-${translation.wordId}"]`);
                if (input && !input.value.trim()) {
                    input.value = translation.translatedText;
                }
            });
            alert(data.message || 'Empty fields filled with English text. Please translate manually.');
        } else {
            alert('Operation failed: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Network error occurred: ' + error.message);
    })
    .finally(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
    });
}
</script>