
<link rel="stylesheet" href="/admin/template/examples/css/dashboard/ecommerce.css">

<div class="page-header">
    <div class="page-title">
        <h1>Monitoring Dashboard</h1>
    </div>
</div>

<div class="page-content">
    <!-- Stats Cards Row -->
    <div class="row">
        <!-- 24h Transactions -->
        <div class="col-lg-3 col-sm-6">
            <div class="widget widget-shadow">
                <div class="widget-content bg-white p-20">
                    <div class="counter text-left">
                        <div class="counter-number-group">
                            <span class="counter-number font-size-40" id="totalTransactions24h">0</span>
                        </div>
                        <div class="counter-label text-uppercase font-size-12">24h Transactions</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 24h Revenue -->
        <div class="col-lg-3 col-sm-6">
            <div class="widget widget-shadow">
                <div class="widget-content bg-white p-20">
                    <div class="counter text-left">
                        <div class="counter-number-group">
                            <span class="counter-number font-size-40" id="revenue24h">$0</span>
                        </div>
                        <div class="counter-label text-uppercase font-size-12">24h Revenue</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Devices -->
        <div class="col-lg-3 col-sm-6">
            <div class="widget widget-shadow">
                <div class="widget-content bg-white p-20">
                    <div class="counter text-left">
                        <div class="counter-number-group">
                            <span class="counter-number font-size-40" id="totalDevices">0</span>
                        </div>
                        <div class="counter-label text-uppercase font-size-12">Total Devices</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Devices -->
        <div class="col-lg-3 col-sm-6">
            <div class="widget widget-shadow">
                <div class="widget-content bg-white p-20">
                    <div class="counter text-left">
                        <div class="counter-number-group">
                            <span class="counter-number font-size-40" id="activeDevices">0</span>
                        </div>
                        <div class="counter-label text-uppercase font-size-12">Active Devices</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Second Stats Row -->
    <div class="row">
        <!-- Trial Devices -->
        <div class="col-lg-3 col-sm-6">
            <div class="widget widget-shadow">
                <div class="widget-content bg-white p-20">
                    <div class="counter text-left">
                        <div class="counter-number-group">
                            <span class="counter-number font-size-40" id="trialDevices">0</span>
                        </div>
                        <div class="counter-label text-uppercase font-size-12">Trial Devices</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 24h Activated Devices -->
        <div class="col-lg-3 col-sm-6">
            <div class="widget widget-shadow">
                <div class="widget-content bg-white p-20">
                    <div class="counter text-left">
                        <div class="counter-number-group">
                            <span class="counter-number font-size-40" id="activatedDevices24h">0</span>
                        </div>
                        <div class="counter-label text-uppercase font-size-12">24h Activated Devices</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Monthly Revenue -->
        <div class="col-lg-3 col-sm-6">
            <div class="widget widget-shadow">
                <div class="widget-content bg-white p-20">
                    <div class="counter text-left">
                        <div class="counter-number-group">
                            <span class="counter-number font-size-40" id="monthlyRevenue">$0</span>
                        </div>
                        <div class="counter-label text-uppercase font-size-12">Monthly Revenue</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty slot for future use -->
        <div class="col-lg-3 col-sm-6">
            <div class="widget widget-shadow">
                <div class="widget-content bg-white p-20">
                    <div class="counter text-left">
                        <div class="counter-number-group">
                            <span class="counter-number font-size-40">-</span>
                        </div>
                        <div class="counter-label text-uppercase font-size-12">Reserved</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Platform Distribution -->
    <div class="row">
        <div class="col-md-12">
            <div class="panel">
                <div class="panel-heading">
                    <h3 class="panel-title">Platform Distribution</h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-2 text-center">
                            <div class="counter">
                                <span class="counter-number font-size-24" id="platform-android">0</span>
                                <div class="counter-label">Android</div>
                            </div>
                        </div>
                        <div class="col-md-2 text-center">
                            <div class="counter">
                                <span class="counter-number font-size-24" id="platform-ios">0</span>
                                <div class="counter-label">iOS</div>
                            </div>
                        </div>
                        <div class="col-md-2 text-center">
                            <div class="counter">
                                <span class="counter-number font-size-24" id="platform-samsung">0</span>
                                <div class="counter-label">Samsung</div>
                            </div>
                        </div>
                        <div class="col-md-2 text-center">
                            <div class="counter">
                                <span class="counter-number font-size-24" id="platform-lg">0</span>
                                <div class="counter-label">LG</div>
                            </div>
                        </div>
                        <div class="col-md-2 text-center">
                            <div class="counter">
                                <span class="counter-number font-size-24" id="platform-tvos">0</span>
                                <div class="counter-label">tvOS</div>
                            </div>
                        </div>
                        <div class="col-md-2 text-center">
                            <div class="counter">
                                <span class="counter-number font-size-24" id="platform-other">0</span>
                                <div class="counter-label">Other</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Include Socket.IO -->
<script src="/socket.io/socket.io.js"></script>

<script>
// Initialize socket connection
const socket = io();

// Function to format currency
function formatCurrency(amount) {
    return '$' + parseFloat(amount).toFixed(2);
}

// Function to animate counter
function animateCounter(element, endValue, isRevenue = false) {
    const duration = 1000; // 1 second
    const startValue = parseInt(element.textContent.replace(/[^0-9.-]/g, '')) || 0;
    const startTime = performance.now();
    
    function updateCounter(currentTime) {
        const elapsedTime = currentTime - startTime;
        const progress = Math.min(elapsedTime / duration, 1);
        
        const currentValue = startValue + (endValue - startValue) * progress;
        
        if (isRevenue) {
            element.textContent = formatCurrency(currentValue);
        } else {
            element.textContent = Math.round(currentValue);
        }
        
        if (progress < 1) {
            requestAnimationFrame(updateCounter);
        }
    }
    
    requestAnimationFrame(updateCounter);
}

// Function to update stats display
function updateStats(data) {
    console.log('Updating stats with data:', data);
    
    // Update counters with animation
    animateCounter(document.getElementById('totalTransactions24h'), data.totalTransactions24h);
    animateCounter(document.getElementById('revenue24h'), data.revenue24h, true);
    animateCounter(document.getElementById('totalDevices'), data.totalDevices);
    animateCounter(document.getElementById('activeDevices'), data.activeDevices);
    animateCounter(document.getElementById('trialDevices'), data.trialDevices);
    animateCounter(document.getElementById('activatedDevices24h'), data.activatedDevices24h);
    animateCounter(document.getElementById('monthlyRevenue'), data.monthlyRevenue, true);
    
    // Update platform distribution
    if (data.platformDistribution) {
        document.getElementById('platform-android').textContent = data.platformDistribution.android;
        document.getElementById('platform-ios').textContent = data.platformDistribution.iOS;
        document.getElementById('platform-samsung').textContent = data.platformDistribution.samsung;
        document.getElementById('platform-lg').textContent = data.platformDistribution.lg;
        document.getElementById('platform-tvos').textContent = data.platformDistribution.tvOS;
        document.getElementById('platform-other').textContent = data.platformDistribution.other;
    }
}

// Socket event listeners
socket.on('connect', function() {
    console.log('Connected to monitoring dashboard');
});

socket.on('disconnect', function() {
    console.log('Disconnected from monitoring dashboard');
});

socket.on('monitoringStats', function(data) {
    console.log('Received monitoring stats:', data);
    updateStats(data);
});

socket.on('connect_error', function(error) {
    console.log('Connection error:', error);
});

// Load initial data via AJAX as fallback
function loadInitialData() {
    fetch('/admin/api/monitoring-stats')
        .then(response => response.json())
        .then(data => {
            console.log('Loaded initial data via API:', data);
            updateStats(data);
        })
        .catch(error => {
            console.log('Error loading initial data:', error);
        });
}

// Load initial data when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadInitialData();
});
</script>
