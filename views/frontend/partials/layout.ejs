<!DOCTYPE html>
<html lang="en">
    <%- include('../partials/head'); %>
    <body>
        <div class="container pt-3">
            <%- include('../partials/header'); %>
        </div>

        <main class="container">
            <!-- Breadcrumb Navigation -->
            <% if (typeof menu !== 'undefined' && menu !== 'home') { %>
                <%- include('breadcrumb.ejs') %>
            <% } %>
            
            <div class="content-container">
                <%- body %>
            </div>

            <div class="modal fade status-modal" id="success-modal">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <!-- Modal Header -->
                        <div class="modal-header">
                            <div class="close-button-container text-right">
                                <button type="button" class="close" data-dismiss="modal"
                                        onclick="closeModal()"
                                >
                                    <i class="far fa-times-circle"></i>
                                </button>
                            </div>
                        </div>
                        <div class="modal-body">
                            <div class="status-icon">
                                <i class="fa fa-check"></i>
                            </div>
                            <div class="status-message" id="status-success-message">
                                Thanks For your payment<br>
                                Your account is active now<br>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade status-modal" id="error-modal">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <!-- Modal Header -->
                        <div class="modal-header">
                            <div class="close-button-container text-right">
                                <button type="button" class="close" data-dismiss="modal"
                                        onclick="closeModal()"
                                >
                                    <i class="far fa-times-circle"></i>
                                </button>
                            </div>
                        </div>
                        <div class="modal-body">
                            <div class="status-icon error-icon">
                                <i class="fa fa-info"></i>
                            </div>
                            <div class="status-message" id="status-error-message">
                                Sorry, You are already activated.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <%- include('../partials/footer'); %>

        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
        <script>
            function showErrorMessage(status,msg=''){
                if(status=='success'){
                    $('#status-success-message').html(msg);
                    $('#success-modal').modal('show');
                }else{
                    $('#status-error-message').html(msg);
                    $('#error-modal').modal('show');
                }
            }
            function closeModal() {
                $('.modal').modal('hide');
            }
            $(document).ready(function () {
                let messages=JSON.parse(`<%- JSON.stringify(messages)%>`)
                if(typeof messages.success!="undefined"){
                    showErrorMessage('success',messages.success[0]);
                }
                else if(typeof messages.error!='undefined'){
                    showErrorMessage('error',messages.error[0])
                }
            })

            $(document).on('keyup', '.mac-address', function () {
                makeMacAddressFormat(this)
            })
            $(document).on('change','.mac-address',function () {
                makeMacAddressFormat(this)
            })
            function makeMacAddressFormat(targetElement) {
                var origin_value=$(targetElement).val();
                var max_count=origin_value.length>=16 ? 16 : origin_value.length;
                for(var i=2;i<max_count;i+=3) {
                    if (origin_value[i] !== ':')
                        origin_value = [origin_value.slice(0,i),':',origin_value.slice(i)].join('');
                }
                $(targetElement).val(origin_value);
            }

            $('#header-toggle').click(function () {
                $('.header-items-container').toggleClass('open');
            })
            
            // Register Service Worker for PWA Support
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('/sw.js')
                        .then(function(registration) {
                            console.log('ServiceWorker registered successfully:', registration.scope);
                        })
                        .catch(function(error) {
                            console.log('ServiceWorker registration failed:', error);
                        });
                });
            }
        </script>
    </body>
</html>
